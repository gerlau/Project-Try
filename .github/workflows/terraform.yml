name: 'Terraform'
on:
  push:
    branches: [main]
jobs:
  terraform:
    name: 'Terraform'
    runs-on: ubuntu-latest

    permissions:
      id-token: write # This is required for requesting the JWT
      contents: read  # This is required for actions/checkout

    steps:
    - uses: actions/checkout@v2

    - id: configure-aws-credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-region: ap-southeast-1
        role-arn: arn:aws:iam::590184123501:role/iam-role-github
        
    - name: Terraform Initialize
      run: terraform init

    - name: Terraform Validate
      run: terraform validate

    - name: Terraform Plan
      run: terraform plan

    - name: Terraform Apply
      run: terraform apply -auto-approve
